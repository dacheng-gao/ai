---
name: handoff
description: 跨会话交接、上下文保存或长任务中断续接时使用。结构化保存→新会话恢复。
---

# 跨会话交接

## 当前状态

!`git branch --show-current 2>/dev/null && git log --oneline -5 2>/dev/null`
!`git status --short 2>/dev/null`

## 触发时机

- 用户明确要求保存进度或交接
- 长任务即将耗尽上下文窗口（回复变慢、开始重复已做的事）
- 完成一个逻辑阶段，准备进入下一阶段
- 当日结束，次日需继续

## 保存流程

1. 将当前进度写入 HANDOFF 文件（默认 `.claude/HANDOFF.md`，不存在时写入项目根目录 `HANDOFF.md`）
2. 提交未暂存的代码变更（遵循 `git-workflow` 规则）
3. 告知用户 HANDOFF 文件位置与恢复方式

## HANDOFF 格式

```markdown
## HANDOFF — [任务名]

### 已完成
- [x] 步骤描述：结果摘要

### 进行中
- 当前分支：`<branch>` @ `<commit-sha>`
- 当前状态：描述

### 下一步（可验证目标）
1. 目标描述 → 期望结果
2. 目标描述 → 期望结果

### 注意事项
- 已知风险 / 设计决策 / 依赖 / 阻塞点
```

## 恢复流程

新会话收到 HANDOFF 文件时：
1. 读取 HANDOFF 文件，跳过"已完成"部分
2. 验证"进行中"的分支和代码状态
3. 从"下一步"的第一个目标继续执行

## 退出标准

- HANDOFF 文件已写入且包含全部必需章节
- 代码变更已提交到对应分支
