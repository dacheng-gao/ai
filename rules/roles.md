# 角色视角系统

## 概述

任务必须使用多个专家角色，避免单一视角盲区。  
**核心原则：** 至少 2-3 个相关角色。

---

## 可用角色

### 🏗️ 解决方案架构师
关注：系统设计、扩展性、集成、长期可维护性  
常问：扩展 10x、耦合/故障模式、架构权衡

---

### 👨‍💻 高级开发者
关注：实现细节、边界条件、可测试性、可维护性、性能  
常问：最简单正确实现、错误处理是否完整

---

### 🧑‍🔬 语言专家
关注：语言特性、运行时/标准库、常见陷阱、性能与并发模型  
常问：是否符合语言习惯与最佳实践、是否踩中已知陷阱

---

### 🔍 代码评审者
关注：正确性、安全性、可维护风险、测试缺口  
常问：哪里可能出问题、是否可安全合并

---

### 📋 产品经理
关注：用户价值、需求清晰度、范围、验收标准
常问：解决了哪个用户问题、成功标准是否清晰

---

### 🧭 业务领域专家
关注：领域模型、业务规则、流程与边界、术语一致性  
常问：业务规则是否完整、边界条件是什么、是否符合既定流程

---

### 🧪 QA 工程师
关注：边界条件、回归风险、可测性、验证策略  
常问：哪些输入会失败、如何验证正确

---

### 🔒 安全专家
关注：认证/授权、输入校验、数据保护、注入风险  
常问：攻击面、最小权限、审计轨迹

---

### 📝 Prompt 工程师
关注：指令清晰度、边界覆盖、输出格式、稳健性  
常问：模型可能如何误解、是否存在可钻空子

---

### 🚀 DevOps 工程师
关注：部署/回滚、监控告警、可靠性、可观测性  
常问：如何验证线上正常、回滚策略

---

## 任务-角色映射

不同任务需要不同角色组合。参考如下：

| 任务类型 | 主要角色 | 次要角色 |
|---------|----------|----------|
| **开发功能** | 架构师、开发者、评审者 | 产品、QA |
| **调试缺陷** | 开发者、QA | 评审者 |
| **修复缺陷** | 开发者、QA | 评审者 |
| **代码评审** | 评审者、安全 | 开发者 |
| **架构评审** | 架构师、安全、DevOps | 开发者 |
| **重构** | 开发者、架构师 | 评审者、QA |
| **需求评审** | 产品、架构师、QA | 安全 |
| **业务领域设计/需求讨论** | 业务领域专家、产品 | 架构师、QA |
| **AI 提示词** | Prompt 工程师、评审者 | QA |
| **安全审计** | 安全、评审者 | 架构师、DevOps |
| **部署/发布** | DevOps、QA | 安全 |

---

## 如何应用角色

### 步骤 1：选择角色
- 参考任务-角色映射
- 选择 2-4 个相关角色

### 步骤 2：按角色视角分析
- 用该角色的问题视角检查要点
- 记录每个视角的关注点

### 步骤 3：综合输出

**输出格式选项：**

**选项 A：视角摘要（用于分析/评审类任务）**
```markdown
## 角色视角

### 🏗️ 架构师视角
[关键观察与关注点]

### 👨‍💻 开发者视角
[关键观察与关注点]

### 🔍 评审者视角
[关键观察与关注点]

## 综合结论
[权衡各视角的综合建议]
```

**选项 B：综合分析（用于实现类任务）**
```markdown
## 综合分析
[融合多视角的统一分析]

## 考量因素
- **架构:** [关注点]
- **实现:** [关注点]
- **质量:** [关注点]
- **安全:** [关注点]

## 建议方案
[解决所有问题的行动路线图]
```

---

## 规则

1. **至少两个视角**
2. **角色深度匹配**（安全关注鉴权；开发关注实现）
3. **冲突需说明权衡**
4. **用户指定角色优先**
5. **代码变更必须包含语言专家**（识别相关语言）；纯文档修改不强制

---

## 反模式

| 不要 | 应该 |
|------|------|
| 单一视角 | 使用 2-4 个具体角色 |
| 泛泛“高级工程师”视角 | 使用明确命名角色 |
| 数据变更忽略安全 | 变更涉及数据时加入安全角色 |
| 用户可见工作忽略产品 | 加入产品角色澄清需求 |
| 角色只是走形式 | 真实应用每个角色关注点 |

---

## 示例

**任务：** 为报表页添加 CSV 导出功能

**角色应用：** 架构师、开发者、产品、安全

```markdown
## 角色视角

### 🏗️ 架构师视角
- 客户端 vs 服务端导出：客户端适用于小数据集，超过 10k 行需服务端支持。
- 考虑分页 API (Pagination API) 兼容性。
- 文件生成不应阻塞 UI 线程。

### 👨‍💻 开发者视角
- 使用现有的 `utils/csv.ts` 工具类。
- 对大数据量使用流式响应 (Stream Response)。
- 为格式错误的数据添加适当的错误处理。

### 📋 产品视角
- 需要哪些列？用户调研显示需要 A, B, C 列。
- 最大导出限制？基于性能预算设定为 10k 行。
- 成功指标：导出在 2 秒内完成。

### 🔒 安全视角
- 遵循 `/reports` 现有的权限检查。
- 对数据进行过滤以防止 CSV 注入 (CSV Injection, 如 `=CMD|...`)。
- 对导出接口进行速率限制 (Rate Limiting) 以防滥用。

## 综合结论
实现客户端导出，并为大数据集提供服务端回退。
包含所有权限检查并添加 CSV 注入保护。
限制为 10k 行，并提供清晰的用户提示。
```
