# 代码质量规范

代码变更任务必须通过以下五道质量门禁方可交付。纯文档/问答任务可跳过编译与测试条目。

> 本文件是所有代码质量维度的唯一定义。`review-code` 等技能引用本文件，不重复定义。

## 1) Correctness（正确性）
- 需求行为实现完整，边界条件可解释
- 错误处理清晰，不吞异常
- 不引入明显回归（接口、时序、输出格式）

## 2) Security（安全）
- 所有外部输入先校验（类型/长度/格式/范围）
- 禁止 SQL/命令拼接，使用参数化或安全 API
- 禁止硬编码密钥、token、凭证
- 访问受保护资源必须做鉴权与归属检查

## 3) Performance（性能）
- 热路径避免 O(n²) 及以上复杂度
- 避免循环内重复 I/O、分配或查询
- 资源（连接、句柄、流）及时释放

## 4) Maintainability（可维护性）
- 单一职责：函数/模块职责清晰
- 命名可读：变量用名词，函数用动词
- 复杂逻辑补充"为什么"的注释
- 避免不必要复杂度与重复实现

## 5) Verification（验证）
- 至少执行与改动直接相关的最小验证
- 能跑测试时优先跑测试；不能跑时说明原因与风险
- 在适用语言中补充 typecheck/build/lint 的最小必要项
- 报告必须包含验证证据（命令、结果、受限项）

## 语言专项底线

| 语言 | 底线要求 |
|------|----------|
| TypeScript/JavaScript | `strict`/类型约束，避免 `any`，优先 `const` |
| Python | 公共 API 使用 type hints，资源操作使用 `with` |
| Go | 不忽略 `error`，避免 goroutine 泄漏（context 控制） |
| Java/C# | 资源正确释放，异常处理有针对性，避免阻塞式反模式 |

## 红旗（出现即优先修复）

- 拼接 SQL 或 shell 命令
- 动态执行不受控代码（如 `eval`）
- 未校验输入直接入库/执行
- 关键错误被忽略或静默失败
- 敏感信息写入日志或硬编码到代码
