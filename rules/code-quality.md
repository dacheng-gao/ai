# 代码质量规范

代码变更任务必须通过以下五道质量门禁方可交付。纯文档/问答任务可跳过编译与测试条目。

> 本文件是所有代码质量维度的唯一定义。`review-code` 等技能引用本文件，不重复定义。

## 1) Correctness（正确性）
- 需求行为实现完整，边界条件可解释
- 错误处理清晰，不吞异常
- 不引入明显回归（接口、时序、输出格式）
- 共享可变状态需有明确同步机制
- 资源（连接、句柄、流）及时释放

## 2) Security（安全）
- 所有外部输入先校验（类型/长度/格式/范围）
- 禁止 SQL/命令拼接，使用参数化或安全 API
- 禁止硬编码密钥、token、凭证
- 访问受保护资源必须做鉴权与归属检查

## 3) Performance（性能）
- 热路径避免 O(n²) 及以上复杂度
- 禁止循环内重复 I/O、分配或查询
- 禁止不必要的大对象拷贝或序列化

## 4) Maintainability（可维护性）
- 单一职责：函数/模块职责清晰
- 命名可读：变量用名词，函数用动词
- 复杂逻辑补充"为什么"的注释
- **DRY 原则**：2+ 处出现相同/高度相似代码时必须消除重复（提取函数/模块/共享组件）

## 5) Verification（验证）

按优先级执行全部适用的验证手段（禁止只挑最少项）：

1. **测试**：能跑必须跑；不能跑时说明原因、残余风险与替代方式
2. **Typecheck / Build**：适用语言必须执行
3. **Lint**：适用语言必须执行
4. **手动验证**：无法自动化时的补充

- 报告必须包含验证证据（完整命令 + 输出摘要 + 受限项）
- 禁止未执行验证就声称"已验证"

## 语言专项底线

| 语言 | 底线要求 |
|------|----------|
| TypeScript/JavaScript | `strict` 模式 + 类型约束，禁止 `any`（`unknown` + 类型守卫替代），优先 `const` |
| Python | 公共 API 使用 type hints，资源操作使用 `with` |
| Go | 不忽略 `error`，禁止 goroutine 泄漏（必须使用 context 控制生命周期） |
| Java/C# | 资源正确释放，异常处理有针对性，禁止阻塞式反模式 |
| Rust | 处理所有 `Result`/`Option`，避免 `unwrap()`（测试除外），生命周期标注明确 |

## 红旗（出现即优先修复）

- 拼接 SQL 或 shell 命令
- 动态执行不受控代码（如 `eval`）
- 未校验输入直接入库/执行
- 关键错误被忽略或静默失败
- 敏感信息写入日志或硬编码到代码
- 跨文件/模块出现完全相同或高度相似的代码块
